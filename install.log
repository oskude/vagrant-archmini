set -o xtrace

################################################################################
# Prepare disk
################################################################################
sgdisk /dev/sda --zap-all
+ sgdisk /dev/sda --zap-all
Creating new GPT entries.
GPT data structures destroyed! You may now partition the disk using fdisk or
other utilities.
sgdisk /dev/sda -n 1:0:0 -t 1:8304 -c 1:'root' -A 1:set:2
+ sgdisk /dev/sda -n 1:0:0 -t 1:8304 -c 1:root -A 1:set:2
Creating new GPT entries.
Setting name!
partNum is 0
The operation has completed successfully.
sleep 1 # without this by-partlabel is not yet populated
+ sleep 1
mkfs.ext4 -T small -O \^64bit /dev/disk/by-partlabel/root
+ mkfs.ext4 -T small -O '^64bit' /dev/disk/by-partlabel/root
mke2fs 1.43.7 (16-Oct-2017)
Creating filesystem with 2046956 1k blocks and 512000 inodes
Filesystem UUID: 0d040ff9-1a6e-43c8-ab36-adaecc0a4298
Superblock backups stored on blocks: 
	8193, 24577, 40961, 57345, 73729, 204801, 221185, 401409, 663553, 
	1024001, 1990657

Allocating group tables:   0/250       done                            
Writing inode tables:   0/250       done                            
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information:   0/250       done

mount /dev/disk/by-partlabel/root /mnt
+ mount /dev/disk/by-partlabel/root /mnt

################################################################################
# Install mini-base
################################################################################
cat <<-'EOF' > /etc/pacman.d/mirrorlist
	Server = http://mirrors.kernel.org/archlinux/$repo/os/$arch
EOF
+ cat
cp pacman.conf /etc/pacman.conf
+ cp pacman.conf /etc/pacman.conf
cp noextract /etc/pacman.d/noextract
+ cp noextract /etc/pacman.d/noextract
pacstrap /mnt filesystem linux systemd bash pacman
+ pacstrap /mnt filesystem linux systemd bash pacman
==> Creating install root at /mnt
==> Installing packages to /mnt
:: Synchronizing package databases...
downloading core.db...
downloading extra.db...
downloading community.db...
resolving dependencies...
looking for conflicting packages...

Packages (95) acl-2.2.52-4  archlinux-keyring-20171020-1  attr-2.4.47-3  bzip2-1.0.6-6  ca-certificates-20170307-1  ca-certificates-cacert-20140824-4  ca-certificates-mozilla-3.34.1-1  ca-certificates-utils-20170307-1  coreutils-8.28-1  cracklib-2.9.6-1  cryptsetup-1.7.5-2  curl-7.57.0-1  db-5.3.28-3  dbus-1.12.2-1  device-mapper-2.02.176-1  e2fsprogs-1.43.7-1  expat-2.2.5-1  findutils-4.6.0-2  gawk-4.2.0-2  gcc-libs-7.2.0-3  gdbm-1.13-1  glib2-2.54.2-2  glibc-2.26-6  gmp-6.1.2-1  gnupg-2.2.3-1  gnutls-3.5.16-1  gpgme-1.9.0-3  grep-3.1-1  gzip-1.8-2  hwids-20171003-1  iana-etc-20170824-1  iptables-1.6.1-1  kbd-2.0.4-1  keyutils-1.5.10-1  kmod-24-1  krb5-1.15.2-1  less-487-1  libarchive-3.3.2-1  libassuan-2.4.3-1  libcap-2.25-1  libcap-ng-0.7.8-1  libelf-0.170-1  libffi-3.2.1-2  libgcrypt-1.8.1-1  libgpg-error-1.27-1  libidn-1.33-2  libidn2-2.0.4-2  libksba-1.3.5-1  libldap-2.4.45-4  libmnl-1.0.4-1  libnftnl-1.0.7-1  libnghttp2-1.27.0-1  libnl-3.4.0-1  libpcap-1.8.1-2  libpsl-0.18.0-2  libsasl-2.1.26-11  libseccomp-2.3.2-1  libsecret-0.18.5+14+g9980655-1  libssh2-1.8.0-2  libsystemd-235.38-2  libtasn1-4.12-2  libtirpc-1.0.2-1  libunistring-0.9.7-1  libusb-1.0.21-2  libutil-linux-2.31-2  linux-api-headers-4.12.7-1  linux-firmware-20171009.bf04291-1  lz4-1:1.8.0-1  mkinitcpio-24-2  mkinitcpio-busybox-1.27.2-1  mpfr-3.1.6.p1-1  ncurses-6.0+20170902-3  nettle-3.4-1  npth-1.5-1  openssl-1.1.0.g-1  p11-kit-0.23.9-1  pacman-mirrorlist-20171027-1  pam-1.3.0-1  pambase-20171006-1  pcre-8.41-1  perl-5.26.1-1  pinentry-1.0.0-1  popt-1.16-9  readline-7.0.003-1  shadow-4.5-2  sqlite-3.21.0-1  tzdata-2017c-1  util-linux-2.31-2  xz-5.2.3-1  zlib-1:1.2.11-2  bash-4.4.012-2  filesystem-2017.03-2  linux-4.13.12-1  pacman-5.0.2-2  systemd-235.38-2

Total Download Size:   195.32 MiB
Total Installed Size:  668.15 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
downloading iana-etc-20170824-1-any.pkg.tar.xz...
downloading filesystem-2017.03-2-x86_64.pkg.tar.xz...
downloading linux-api-headers-4.12.7-1-any.pkg.tar.xz...
downloading tzdata-2017c-1-any.pkg.tar.xz...
downloading glibc-2.26-6-x86_64.pkg.tar.xz...
downloading attr-2.4.47-3-x86_64.pkg.tar.xz...
downloading acl-2.2.52-4-x86_64.pkg.tar.xz...
downloading gcc-libs-7.2.0-3-x86_64.pkg.tar.xz...
downloading ncurses-6.0+20170902-3-x86_64.pkg.tar.xz...
downloading readline-7.0.003-1-x86_64.pkg.tar.xz...
downloading bash-4.4.012-2-x86_64.pkg.tar.xz...
downloading gmp-6.1.2-1-x86_64.pkg.tar.xz...
downloading libcap-2.25-1-x86_64.pkg.tar.xz...
downloading gdbm-1.13-1-x86_64.pkg.tar.xz...
downloading db-5.3.28-3-x86_64.pkg.tar.xz...
downloading perl-5.26.1-1-x86_64.pkg.tar.xz...
downloading openssl-1.1.0.g-1-x86_64.pkg.tar.xz...
downloading coreutils-8.28-1-x86_64.pkg.tar.xz...
downloading linux-firmware-20171009.bf04291-1-any.pkg.tar.xz...
downloading zlib-1:1.2.11-2-x86_64.pkg.tar.xz...
downloading xz-5.2.3-1-x86_64.pkg.tar.xz...
downloading kmod-24-1-x86_64.pkg.tar.xz...
downloading mpfr-3.1.6.p1-1-x86_64.pkg.tar.xz...
downloading gawk-4.2.0-2-x86_64.pkg.tar.xz...
downloading mkinitcpio-busybox-1.27.2-1-x86_64.pkg.tar.xz...
downloading cracklib-2.9.6-1-x86_64.pkg.tar.xz...
downloading libutil-linux-2.31-2-x86_64.pkg.tar.xz...
downloading e2fsprogs-1.43.7-1-x86_64.pkg.tar.xz...
downloading libsasl-2.1.26-11-x86_64.pkg.tar.xz...
downloading libldap-2.4.45-4-x86_64.pkg.tar.xz...
downloading keyutils-1.5.10-1-x86_64.pkg.tar.xz...
downloading krb5-1.15.2-1-x86_64.pkg.tar.xz...
downloading libtirpc-1.0.2-1-x86_64.pkg.tar.xz...
downloading pambase-20171006-1-any.pkg.tar.xz...
downloading pam-1.3.0-1-x86_64.pkg.tar.xz...
downloading shadow-4.5-2-x86_64.pkg.tar.xz...
downloading libgpg-error-1.27-1-x86_64.pkg.tar.xz...
downloading libgcrypt-1.8.1-1-x86_64.pkg.tar.xz...
downloading lz4-1:1.8.0-1-x86_64.pkg.tar.xz...
downloading libsystemd-235.38-2-x86_64.pkg.tar.xz...
downloading util-linux-2.31-2-x86_64.pkg.tar.xz...
downloading bzip2-1.0.6-6-x86_64.pkg.tar.xz...
downloading expat-2.2.5-1-x86_64.pkg.tar.xz...
downloading libarchive-3.3.2-1-x86_64.pkg.tar.xz...
downloading findutils-4.6.0-2-x86_64.pkg.tar.xz...
downloading pcre-8.41-1-x86_64.pkg.tar.xz...
downloading grep-3.1-1-x86_64.pkg.tar.xz...
downloading less-487-1-x86_64.pkg.tar.xz...
downloading gzip-1.8-2-x86_64.pkg.tar.xz...
downloading device-mapper-2.02.176-1-x86_64.pkg.tar.xz...
downloading popt-1.16-9-x86_64.pkg.tar.xz...
downloading cryptsetup-1.7.5-2-x86_64.pkg.tar.xz...
downloading dbus-1.12.2-1-x86_64.pkg.tar.xz...
downloading libmnl-1.0.4-1-x86_64.pkg.tar.xz...
downloading libnftnl-1.0.7-1-x86_64.pkg.tar.xz...
downloading libnl-3.4.0-1-x86_64.pkg.tar.xz...
downloading libusb-1.0.21-2-x86_64.pkg.tar.xz...
downloading libpcap-1.8.1-2-x86_64.pkg.tar.xz...
downloading iptables-1.6.1-1-x86_64.pkg.tar.xz...
downloading kbd-2.0.4-1-x86_64.pkg.tar.xz...
downloading hwids-20171003-1-any.pkg.tar.xz...
downloading libidn-1.33-2-x86_64.pkg.tar.xz...
downloading libelf-0.170-1-x86_64.pkg.tar.xz...
downloading libseccomp-2.3.2-1-x86_64.pkg.tar.xz...
downloading systemd-235.38-2-x86_64.pkg.tar.xz...
downloading mkinitcpio-24-2-any.pkg.tar.xz...
downloading linux-4.13.12-1-x86_64.pkg.tar.xz...
downloading libtasn1-4.12-2-x86_64.pkg.tar.xz...
downloading libffi-3.2.1-2-x86_64.pkg.tar.xz...
downloading p11-kit-0.23.9-1-x86_64.pkg.tar.xz...
downloading ca-certificates-utils-20170307-1-any.pkg.tar.xz...
downloading ca-certificates-mozilla-3.34.1-1-x86_64.pkg.tar.xz...
downloading ca-certificates-cacert-20140824-4-any.pkg.tar.xz...
downloading ca-certificates-20170307-1-any.pkg.tar.xz...
downloading libssh2-1.8.0-2-x86_64.pkg.tar.xz...
downloading libunistring-0.9.7-1-x86_64.pkg.tar.xz...
downloading libidn2-2.0.4-2-x86_64.pkg.tar.xz...
downloading libpsl-0.18.0-2-x86_64.pkg.tar.xz...
downloading libnghttp2-1.27.0-1-x86_64.pkg.tar.xz...
downloading curl-7.57.0-1-x86_64.pkg.tar.xz...
downloading npth-1.5-1-x86_64.pkg.tar.xz...
downloading libksba-1.3.5-1-x86_64.pkg.tar.xz...
downloading libassuan-2.4.3-1-x86_64.pkg.tar.xz...
downloading glib2-2.54.2-2-x86_64.pkg.tar.xz...
downloading libsecret-0.18.5+14+g9980655-1-x86_64.pkg.tar.xz...
downloading pinentry-1.0.0-1-x86_64.pkg.tar.xz...
downloading nettle-3.4-1-x86_64.pkg.tar.xz...
downloading gnutls-3.5.16-1-x86_64.pkg.tar.xz...
downloading sqlite-3.21.0-1-x86_64.pkg.tar.xz...
downloading gnupg-2.2.3-1-x86_64.pkg.tar.xz...
downloading gpgme-1.9.0-3-x86_64.pkg.tar.xz...
downloading pacman-mirrorlist-20171027-1-any.pkg.tar.xz...
downloading archlinux-keyring-20171020-1-any.pkg.tar.xz...
downloading pacman-5.0.2-2-x86_64.pkg.tar.xz...
downloading libcap-ng-0.7.8-1-x86_64.pkg.tar.xz...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing iana-etc...
installing filesystem...
installing linux-api-headers...
installing tzdata...
installing glibc...
Optional dependencies for glibc
    gd: for memusagestat
installing attr...
installing acl...
installing gcc-libs...
installing ncurses...
warning: warning given when extracting /mnt/usr/share/terminfo/l/la120 (Hard-link target 'usr/share/terminfo/d/dw3' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/x1700-lm (Hard-link target 'usr/share/terminfo/d/diablo1740-lm' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xerox-lm (Hard-link target 'usr/share/terminfo/d/diablo-lm' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xerox (Hard-link target 'usr/share/terminfo/d/diablo' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/x1700 (Hard-link target 'usr/share/terminfo/d/diablo' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xenix (Hard-link target 'usr/share/terminfo/i/ibmx' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xdku (Hard-link target 'usr/share/terminfo/t/tws2103' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xterm-color (Hard-link target 'usr/share/terminfo/n/nxterm' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xterms (Hard-link target 'usr/share/terminfo/v/vs100' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xterm-24 (Hard-link target 'usr/share/terminfo/v/vs100' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/x10term (Hard-link target 'usr/share/terminfo/v/vs100-x10' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xwsh (Hard-link target 'usr/share/terminfo/i/iris-color' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-256x96 (Hard-link target 'usr/share/terminfo/d/darwin-256x96' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-256x96-m (Hard-link target 'usr/share/terminfo/d/darwin-256x96-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-200x75 (Hard-link target 'usr/share/terminfo/d/darwin-200x75' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-200x75-m (Hard-link target 'usr/share/terminfo/d/darwin-200x75-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-200x64 (Hard-link target 'usr/share/terminfo/d/darwin-200x64' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-200x64-m (Hard-link target 'usr/share/terminfo/d/darwin-200x64-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-160x64 (Hard-link target 'usr/share/terminfo/d/darwin-160x64' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-160x64-m (Hard-link target 'usr/share/terminfo/d/darwin-160x64-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-144x48 (Hard-link target 'usr/share/terminfo/d/darwin-144x48' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-144x48-m (Hard-link target 'usr/share/terminfo/d/darwin-144x48-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-128x48 (Hard-link target 'usr/share/terminfo/d/darwin-128x48' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-128x48-m (Hard-link target 'usr/share/terminfo/d/darwin-128x48-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-128x40 (Hard-link target 'usr/share/terminfo/d/darwin-128x40' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-128x40-m (Hard-link target 'usr/share/terminfo/d/darwin-128x40-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-112x37 (Hard-link target 'usr/share/terminfo/d/darwin-112x37' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-112x37-m (Hard-link target 'usr/share/terminfo/d/darwin-112x37-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-100x37 (Hard-link target 'usr/share/terminfo/d/darwin-100x37' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-100x37-m (Hard-link target 'usr/share/terminfo/d/darwin-100x37-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-90x30 (Hard-link target 'usr/share/terminfo/d/darwin-90x30' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-90x30-m (Hard-link target 'usr/share/terminfo/d/darwin-90x30-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-80x30 (Hard-link target 'usr/share/terminfo/d/darwin-80x30' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-80x30-m (Hard-link target 'usr/share/terminfo/d/darwin-80x30-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-80x25 (Hard-link target 'usr/share/terminfo/d/darwin-80x25' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-80x25-m (Hard-link target 'usr/share/terminfo/d/darwin-80x25-m' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-f2 (Hard-link target 'usr/share/terminfo/d/darwin-f2' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-m-f2 (Hard-link target 'usr/share/terminfo/d/darwin-m-f2' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-f (Hard-link target 'usr/share/terminfo/d/darwin-f' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-m-f (Hard-link target 'usr/share/terminfo/d/darwin-m-f' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-b (Hard-link target 'usr/share/terminfo/d/darwin-b' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-m-b (Hard-link target 'usr/share/terminfo/d/darwin-m-b' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc (Hard-link target 'usr/share/terminfo/d/darwin' does not exist.)
warning: warning given when extracting /mnt/usr/share/terminfo/x/xnuppc-m (Hard-link target 'usr/share/terminfo/d/darwin-m' does not exist.)
installing readline...
installing bash...
Optional dependencies for bash
    bash-completion: for tab completion
installing gmp...
installing libcap...
installing gdbm...
installing db...
installing perl...
installing openssl...
Optional dependencies for openssl
    ca-certificates [pending]
installing coreutils...
installing linux-firmware...
installing zlib...
installing xz...
installing kmod...
installing mpfr...
installing gawk...
installing mkinitcpio-busybox...
installing cracklib...
installing libutil-linux...
installing e2fsprogs...
installing libsasl...
installing libldap...
installing keyutils...
installing krb5...
installing libtirpc...
installing pambase...
installing pam...
installing shadow...
installing libgpg-error...
installing libgcrypt...
installing lz4...
installing libsystemd...
installing libcap-ng...
installing util-linux...
Optional dependencies for util-linux
    python: python bindings to libmount
installing bzip2...
installing expat...
installing libarchive...
installing findutils...
installing pcre...
installing grep...
installing less...
installing gzip...
installing device-mapper...
installing popt...
installing cryptsetup...
installing dbus...
installing libmnl...
installing libnftnl...
installing libnl...
installing libusb...
installing libpcap...
installing iptables...
installing kbd...
installing hwids...
installing libidn...
installing libelf...
installing libseccomp...
installing systemd...
Initializing machine ID from random generator.
Created symlink /etc/systemd/system/getty.target.wants/getty@tty1.service → /usr/lib/systemd/system/getty@.service.
Created symlink /etc/systemd/system/multi-user.target.wants/remote-fs.target → /usr/lib/systemd/system/remote-fs.target.
:: Append 'init=/usr/lib/systemd/systemd' to your kernel command line in your
   bootloader to replace sysvinit with systemd, or install systemd-sysvcompat
Optional dependencies for systemd
    libmicrohttpd: remote journald capabilities
    quota-tools: kernel-level quota management
    systemd-sysvcompat: symlink package to provide sysvinit binaries
    polkit: allow administration as unprivileged user
installing mkinitcpio...
Optional dependencies for mkinitcpio
    xz: Use lzma or xz compression for the initramfs image [installed]
    bzip2: Use bzip2 compression for the initramfs image [installed]
    lzop: Use lzo compression for the initramfs image
    lz4: Use lz4 compression for the initramfs image [installed]
    mkinitcpio-nfs-utils: Support for root filesystem on NFS
installing linux...
>>> Updating module dependencies. Please wait ...
Optional dependencies for linux
    crda: to set the correct wireless channels of your country
installing libtasn1...
installing libffi...
installing p11-kit...
installing ca-certificates-utils...
installing ca-certificates-mozilla...
installing ca-certificates-cacert...
installing ca-certificates...
installing libssh2...
installing libunistring...
installing libidn2...
installing libpsl...
installing libnghttp2...
installing curl...
installing npth...
installing libksba...
installing libassuan...
installing glib2...
Optional dependencies for glib2
    python: for gdbus-codegen and gtester-report
    libelf: gresource inspection tool [installed]
installing libsecret...
Optional dependencies for libsecret
    gnome-keyring: key storage service (or use any other service implementing org.freedesktop.secrets)
installing pinentry...
Optional dependencies for pinentry
    gtk2: gtk2 backend
    qt5-base: qt backend
    gcr: gnome3 backend
installing nettle...
installing gnutls...
Optional dependencies for gnutls
    guile: for use with Guile bindings
installing sqlite...
installing gnupg...
Optional dependencies for gnupg
    libldap: gpg2keys_ldap [installed]
    libusb-compat: scdaemon
installing gpgme...
installing pacman-mirrorlist...
installing archlinux-keyring...
installing pacman...
:: Running post-transaction hooks...
(1/6) Updating linux initcpios
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
==> Starting build: 4.13.12-1-ARCH
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [autodetect]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
==> ERROR: module not found: `usbhid'
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating gzip-compressed initcpio image: /boot/initramfs-linux.img
==> WARNING: errors were encountered during the build. The image may not be complete.
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'fallback'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux-fallback.img -S autodetect
==> Starting build: 4.13.12-1-ARCH
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
==> ERROR: module not found: `usbhid'
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating gzip-compressed initcpio image: /boot/initramfs-linux-fallback.img
==> WARNING: errors were encountered during the build. The image may not be complete.
error: command failed to execute correctly
(2/6) Warn about old perl modules
perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
	LANGUAGE = (unset),
	LC_ALL = (unset),
	LANG = "en_US.UTF-8"
    are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").
(3/6) Updating system user accounts...
(4/6) Creating temporary files...
(5/6) Arming ConditionNeedsUpdate...
(6/6) Rebuilding certificate stores...
rm /mnt/var/cache/pacman/pkg/*
+ rm /mnt/var/cache/pacman/pkg/acl-2.2.52-4-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/archlinux-keyring-20171020-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/attr-2.4.47-3-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/bash-4.4.012-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/bzip2-1.0.6-6-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/ca-certificates-20170307-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/ca-certificates-cacert-20140824-4-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/ca-certificates-mozilla-3.34.1-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/ca-certificates-utils-20170307-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/coreutils-8.28-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/cracklib-2.9.6-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/cryptsetup-1.7.5-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/curl-7.57.0-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/db-5.3.28-3-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/dbus-1.12.2-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/device-mapper-2.02.176-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/e2fsprogs-1.43.7-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/expat-2.2.5-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/filesystem-2017.03-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/findutils-4.6.0-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/gawk-4.2.0-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/gcc-libs-7.2.0-3-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/gdbm-1.13-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/glib2-2.54.2-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/glibc-2.26-6-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/gmp-6.1.2-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/gnupg-2.2.3-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/gnutls-3.5.16-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/gpgme-1.9.0-3-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/grep-3.1-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/gzip-1.8-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/hwids-20171003-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/iana-etc-20170824-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/iptables-1.6.1-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/kbd-2.0.4-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/keyutils-1.5.10-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/kmod-24-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/krb5-1.15.2-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/less-487-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libarchive-3.3.2-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libassuan-2.4.3-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libcap-2.25-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libcap-ng-0.7.8-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libelf-0.170-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libffi-3.2.1-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libgcrypt-1.8.1-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libgpg-error-1.27-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libidn-1.33-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libidn2-2.0.4-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libksba-1.3.5-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libldap-2.4.45-4-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libmnl-1.0.4-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libnftnl-1.0.7-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libnghttp2-1.27.0-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libnl-3.4.0-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libpcap-1.8.1-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libpsl-0.18.0-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libsasl-2.1.26-11-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libseccomp-2.3.2-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libsecret-0.18.5+14+g9980655-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libssh2-1.8.0-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libsystemd-235.38-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libtasn1-4.12-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libtirpc-1.0.2-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libunistring-0.9.7-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libusb-1.0.21-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libutil-linux-2.31-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/linux-4.13.12-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/linux-api-headers-4.12.7-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/linux-firmware-20171009.bf04291-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/lz4-1:1.8.0-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/mkinitcpio-24-2-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/mkinitcpio-busybox-1.27.2-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/mpfr-3.1.6.p1-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/ncurses-6.0+20170902-3-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/nettle-3.4-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/npth-1.5-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/openssl-1.1.0.g-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/p11-kit-0.23.9-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/pacman-5.0.2-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/pacman-mirrorlist-20171027-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/pam-1.3.0-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/pambase-20171006-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/pcre-8.41-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/perl-5.26.1-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/pinentry-1.0.0-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/popt-1.16-9-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/readline-7.0.003-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/shadow-4.5-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/sqlite-3.21.0-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/systemd-235.38-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/tzdata-2017c-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/util-linux-2.31-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/xz-5.2.3-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/zlib-1:1.2.11-2-x86_64.pkg.tar.xz
cp /etc/pacman.conf /mnt/etc/pacman.conf
+ cp /etc/pacman.conf /mnt/etc/pacman.conf
cp noextract /mnt/etc/pacman.d/
+ cp noextract /mnt/etc/pacman.d/
ln -sf /usr/share/zoneinfo/UTC /mnt/etc/localtime
+ ln -sf /usr/share/zoneinfo/UTC /mnt/etc/localtime
cat <<-'EOF' > /mnt/etc/locale.conf
	LANG=C
EOF
+ cat
cat <<-'EOF' > /mnt/etc/fstab
	tmpfs /var/log             tmpfs rw 0 0
	tmpfs /var/cache           tmpfs rw 0 0
	tmpfs /var/lib/pacman/sync tmpfs rw 0 0
EOF
+ cat
cat <<-'EOF' > /mnt/etc/mkinitcpio.d/linux.preset
	ALL_config="/etc/mkinitcpio.conf"
	ALL_kver="/boot/vmlinuz-linux"
	PRESETS=('default')
	default_image="/boot/initramfs-linux.img"
EOF
+ cat
rm /mnt/boot/initramfs-linux-fallback.img
+ rm /mnt/boot/initramfs-linux-fallback.img
arch-chroot /mnt mkinitcpio -p linux
+ arch-chroot /mnt mkinitcpio -p linux
==> Building image from preset: /etc/mkinitcpio.d/linux.preset: 'default'
  -> -k /boot/vmlinuz-linux -c /etc/mkinitcpio.conf -g /boot/initramfs-linux.img
==> Starting build: 4.13.12-1-ARCH
  -> Running build hook: [base]
  -> Running build hook: [udev]
  -> Running build hook: [autodetect]
  -> Running build hook: [modconf]
  -> Running build hook: [block]
  -> Running build hook: [filesystems]
  -> Running build hook: [keyboard]
==> ERROR: module not found: `usbhid'
  -> Running build hook: [fsck]
==> Generating module dependencies
==> Creating gzip-compressed initcpio image: /boot/initramfs-linux.img
==> WARNING: errors were encountered during the build. The image may not be complete.

################################################################################
# Vagrant specifics
################################################################################
arch-chroot /mnt pacman -S --noconfirm \
	systemd-sysvcompat \
	openssh \
	sudo \
	sed \
	virtualbox-guest-utils-nox \
	virtualbox-guest-modules-arch \
	iproute2 \
	netctl \
	dhcpcd
+ arch-chroot /mnt pacman -S --noconfirm systemd-sysvcompat openssh sudo sed virtualbox-guest-utils-nox virtualbox-guest-modules-arch iproute2 netctl dhcpcd
resolving dependencies...
looking for conflicting packages...

Packages (13) dnssec-anchors-20170711-1  ldns-1.7.0-4  libedit-20170329_3.1-1  openresolv-3.9.0-1  dhcpcd-6.11.5-1  iproute2-4.14.1-2  netctl-1.14-1  openssh-7.6p1-1  sed-4.4-1  sudo-1.8.21.p2-1  systemd-sysvcompat-235.38-2  virtualbox-guest-modules-arch-5.2.2-4  virtualbox-guest-utils-nox-5.2.2-2

Total Download Size:    3.84 MiB
Total Installed Size:  16.78 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
downloading systemd-sysvcompat-235.38-2-x86_64.pkg.tar.xz...
downloading libedit-20170329_3.1-1-x86_64.pkg.tar.xz...
downloading dnssec-anchors-20170711-1-any.pkg.tar.xz...
downloading ldns-1.7.0-4-x86_64.pkg.tar.xz...
downloading openssh-7.6p1-1-x86_64.pkg.tar.xz...
downloading sudo-1.8.21.p2-1-x86_64.pkg.tar.xz...
downloading sed-4.4-1-x86_64.pkg.tar.xz...
downloading iproute2-4.14.1-2-x86_64.pkg.tar.xz...
downloading openresolv-3.9.0-1-any.pkg.tar.xz...
downloading netctl-1.14-1-any.pkg.tar.xz...
downloading dhcpcd-6.11.5-1-x86_64.pkg.tar.xz...
downloading virtualbox-guest-modules-arch-5.2.2-4-x86_64.pkg.tar.xz...
downloading virtualbox-guest-utils-nox-5.2.2-2-x86_64.pkg.tar.xz...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing systemd-sysvcompat...
installing libedit...
installing dnssec-anchors...
installing ldns...
Optional dependencies for ldns
    libpcap: ldns-dpa tool [installed]
installing openssh...
Optional dependencies for openssh
    xorg-xauth: X11 forwarding
    x11-ssh-askpass: input passphrase in X
installing sudo...
installing sed...
installing virtualbox-guest-modules-arch...
installing virtualbox-guest-utils-nox...
installing iproute2...
Optional dependencies for iproute2
    linux-atm: ATM support
installing openresolv...
installing netctl...
Optional dependencies for netctl
    dialog: for the menu based wifi assistant
    dhclient: for DHCP support (or dhcpcd)
    dhcpcd: for DHCP support (or dhclient) [pending]
    wpa_supplicant: for wireless networking support
    ifplugd: for automatic wired connections through netctl-ifplugd
    wpa_actiond: for automatic wireless connections through netctl-auto
    ppp: for PPP connections
    openvswitch: for Open vSwitch connections
installing dhcpcd...
Optional dependencies for dhcpcd
    openresolv: resolvconf support [installed]
:: Running post-transaction hooks...
(1/3) Updating system user accounts...
(2/3) Creating temporary files...
(3/3) Arming ConditionNeedsUpdate...
# we don't need perl with openssl
arch-chroot /mnt pacman --noconfirm -Rddnsu perl
+ arch-chroot /mnt pacman --noconfirm -Rddnsu perl

Packages (3) db-5.3.28-3  gdbm-1.13-1  perl-5.26.1-1

Total Removed Size:  58.78 MiB

:: Do you want to remove these packages? [Y/n] 
:: Processing package changes...
removing perl...
removing db...
removing gdbm...
:: Running post-transaction hooks...
(1/1) Arming ConditionNeedsUpdate...
rm /mnt/var/cache/pacman/pkg/*
+ rm /mnt/var/cache/pacman/pkg/dhcpcd-6.11.5-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/dnssec-anchors-20170711-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/iproute2-4.14.1-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/ldns-1.7.0-4-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/libedit-20170329_3.1-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/netctl-1.14-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/openresolv-3.9.0-1-any.pkg.tar.xz /mnt/var/cache/pacman/pkg/openssh-7.6p1-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/sed-4.4-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/sudo-1.8.21.p2-1-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/systemd-sysvcompat-235.38-2-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/virtualbox-guest-modules-arch-5.2.2-4-x86_64.pkg.tar.xz /mnt/var/cache/pacman/pkg/virtualbox-guest-utils-nox-5.2.2-2-x86_64.pkg.tar.xz
cat <<-'EOF' > /mnt/etc/ssh/sshd_config
	UseDNS no
EOF
+ cat
cat <<-'EOF' > /mnt/etc/sudoers.d/vagrant
	vagrant ALL=(ALL) NOPASSWD: ALL
EOF
+ cat
cat <<-'EOF' > /mnt/etc/netctl/wired-dhcp
	Description='A basic dhcp ethernet connection'
	Interface=enp0s3
	Connection=ethernet
	IP=dhcp
EOF
+ cat
arch-chroot /mnt systemctl enable sshd.socket
+ arch-chroot /mnt systemctl enable sshd.socket
Created symlink /etc/systemd/system/sockets.target.wants/sshd.socket → /usr/lib/systemd/system/sshd.socket.
arch-chroot /mnt netctl enable wired-dhcp
+ arch-chroot /mnt netctl enable wired-dhcp
ln -s '/etc/systemd/system/netctl@wired\x2ddhcp.service' '/etc/systemd/system/multi-user.target.wants/netctl@wired\x2ddhcp.service'
arch-chroot /mnt ssh-keygen -f /etc/ssh/ssh_host_rsa_key -N '' -t rsa
+ arch-chroot /mnt ssh-keygen -f /etc/ssh/ssh_host_rsa_key -N '' -t rsa
Generating public/private rsa key pair.
Your identification has been saved in /etc/ssh/ssh_host_rsa_key.
Your public key has been saved in /etc/ssh/ssh_host_rsa_key.pub.
The key fingerprint is:
SHA256:/EjyEFd2p4L26sHcX3BvowAdn/lrYG4f4dKUTPhvPqM root@archiso
The key's randomart image is:
+---[RSA 2048]----+
|          o . .  |
|         + . o.  |
|      . + .... . |
|       = ...o * .|
|      o S....+.* |
|       B =.  ==.o|
|        B o.o.o*=|
|       . . ..+oB+|
|        .   oE+o+|
+----[SHA256]-----+
arch-chroot /mnt ssh-keygen -f /etc/ssh/ssh_host_dsa_key -N '' -t dsa
+ arch-chroot /mnt ssh-keygen -f /etc/ssh/ssh_host_dsa_key -N '' -t dsa
Generating public/private dsa key pair.
Your identification has been saved in /etc/ssh/ssh_host_dsa_key.
Your public key has been saved in /etc/ssh/ssh_host_dsa_key.pub.
The key fingerprint is:
SHA256:X+lQHZK1ALHNtqJkNo0jK64zv6Mftv5CeFp/fg31czg root@archiso
The key's randomart image is:
+---[DSA 1024]----+
|          ooooo  |
|           +.+ o |
|          . = o  |
|         o o.o   |
|   .  . S +.+. . |
|  . +  * =.=  E .|
|   =+.. . .o.  + |
|  +oo+. . . .    |
|  oOB=.o..       |
+----[SHA256]-----+
arch-chroot /mnt <<-'EOF'
	useradd -m vagrant
	chpasswd <<<"vagrant:vagrant"
	echo 'vagrant ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers
	install -d -o vagrant -g vagrant -m 0700 /home/vagrant/.ssh
	curl -Lo /home/vagrant/.ssh/authorized_keys 'https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub'
	chown vagrant:vagrant /home/vagrant/.ssh/authorized_keys
	chmod 0600 /home/vagrant/.ssh/authorized_keys
EOF
+ arch-chroot /mnt
[root@archiso /]# useradd -m vagrant
[root@archiso /]# chpasswd <<<"vagrant:vagrant"
[root@archiso /]# echo 'vagrant ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers
[root@archiso /]# install -d -o vagrant -g vagrant -m 0700 /home/vagrant/.ssh
[root@archiso /]# curl -Lo /home/vagrant/.ssh/authorized_keys 'https://raw.githubb.com/mitchellh/vagrant/master/keys/vagrant.pub'
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
100   409  100   409    0     0    409      0  0:00:01 --:--:--  0:00:01   409
[root@archiso /]# chown vagrant:vagrant /home/vagrant/.ssh/authorized_keys
[root@archiso /]# chmod 0600 /home/vagrant/.ssh/authorized_keys
[root@archiso /]# exit

################################################################################
# Install bootloader
################################################################################
arch-chroot /mnt pacman -S --noconfirm syslinux
+ arch-chroot /mnt pacman -S --noconfirm syslinux
resolving dependencies...
looking for conflicting packages...

Packages (1) syslinux-6.03-7

Total Download Size:   1.46 MiB
Total Installed Size:  4.62 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
downloading syslinux-6.03-7-x86_64.pkg.tar.xz...
checking keyring...
checking package integrity...
loading package files...
checking for file conflicts...
checking available disk space...
:: Processing package changes...
installing syslinux...

==> For setting up Syslinux BIOS using the syslinux-install_update script follow
    https://wiki.archlinux.org/index.php/Syslinux#Automatic_Install
Optional dependencies for syslinux
    perl-crypt-passwdmd5: For md5pass
    perl-digest-sha1: For sha1pass
    mtools: For mkdiskimage and syslinux support
    gptfdisk: For GPT support
    util-linux: For isohybrid [installed]
    efibootmgr: For EFI support
    dosfstools: For EFI support
:: Running post-transaction hooks...
(1/1) Arming ConditionNeedsUpdate...
arch-chroot /mnt syslinux-install_update -im
+ arch-chroot /mnt syslinux-install_update -im
Syslinux BIOS install successful
Installed MBR (/usr/lib/syslinux/bios/gptmbr.bin) to /dev/sda
rm /mnt/var/cache/pacman/pkg/*
+ rm /mnt/var/cache/pacman/pkg/syslinux-6.03-7-x86_64.pkg.tar.xz
cat <<-'EOF'> /mnt/boot/syslinux/syslinux.cfg
	PROMPT 1
	TIMEOUT 1
	DEFAULT arch
	LABEL arch
	MENU LABEL Arch Linux
	LINUX ../vmlinuz-linux
	APPEND root=PARTLABEL=root init=/usr/lib/systemd/systemd rw
	INITRD ../initramfs-linux.img
EOF
+ cat

################################################################################
# Remove non-critical
################################################################################
rm -rf /mnt/usr/lib/syslinux/*
+ rm -rf /mnt/usr/lib/syslinux/bios /mnt/usr/lib/syslinux/diag /mnt/usr/lib/syslinux/efi32 /mnt/usr/lib/syslinux/efi64
rm -rf /mnt/var/log/*
+ rm -rf /mnt/var/log/btmp /mnt/var/log/journal /mnt/var/log/lastlog /mnt/var/log/old /mnt/var/log/pacman.log /mnt/var/log/tallylog /mnt/var/log/wtmp
rm -rf /mnt/var/cache/*
+ rm -rf /mnt/var/cache/ldconfig /mnt/var/cache/pacman
rm -rf /mnt/var/lib/pacman/sync/*
+ rm -rf /mnt/var/lib/pacman/sync/community.db /mnt/var/lib/pacman/sync/core.db /mnt/var/lib/pacman/sync/extra.db
rm -rf /mnt/usr/lib/syslinux/*
+ rm -rf '/mnt/usr/lib/syslinux/*'
rm -rf /mnt/lost+found
+ rm -rf /mnt/lost+found

################################################################################
# Exit
################################################################################
cp /install.log /mnt/
+ cp /install.log /mnt/
